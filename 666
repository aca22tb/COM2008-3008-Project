package com.mycompany.loginapp;

import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableColumn;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class Products {

    private DefaultTableModel model;
    private JTable table;

    public Products() {
        // Set up the JFrame
        JFrame frame = new JFrame("Product Table Example");
        frame.setSize(1000, 400);
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

        // Create the table model with column names
        model = new DefaultTableModel();
        model.addColumn("Brands' Name");
        model.addColumn("Name");
        model.addColumn("Code");
        model.addColumn("Price");

        // Create the JTable with the model
        table = new JTable(model);

        // Set the preferred width for the second column
        TableColumn column = table.getColumnModel().getColumn(1);
        column.setPreferredWidth(350);

        // Create a scroll pane and add the table to it
        JScrollPane scrollPane = new JScrollPane(table);

        // Add the scroll pane to the frame
        frame.add(scrollPane);

        // Add some sample data to the table
        addRowToTable("Hornby", "L&MR No.58 'Tiger'", "P00312", 229.99);
        addRowToTable("Hornby", "Red Rover Train Set", "M00123", 119.99);
        addRowToTable("Hornby", "BR, Class 50, Co-Co 'Leviathan'", "L00654", 167.99);
        addRowToTable("Hornby", "Analogue Train and Accessory Controller", "C00879", 19.49);
        addRowToTable("Hornby", "Pullman third class brake no.162", "S00978", 53.49);

        addRowToTable("Bachmann", "Remote crossover turnout left, HO scale", "R00417", 122.00);
        addRowToTable("Bachmann", "Power Pack and Speed Controller", "C00258", 102.00);
        addRowToTable("Bachmann", "Alaska GP40", "L00582", 135.00);
        addRowToTable("Bachmann", "Boxcar-Union Pacific", "S00396", 39.99);
        addRowToTable("Bachmann", "Chattanooga Train Set (HO scale)", "M00159", 325.00);

        addRowToTable("Graham Farish", "Western Rambler Train Set", "M00915", 189.99);
        addRowToTable("Graham Farish", "Class 90/0 'Financial Times' BR Intercity", "L00375", 194.95);
        addRowToTable("Graham Farish", "7 Plank Wagon End Door BR GREY", "S00864", 19.95);
        addRowToTable("Graham Farish", "Gaugemaster Single Track Controller with Transformer", "C00624", 51.99);
        addRowToTable("Graham Farish", "LGB Right Electric Turnout, R1, 30°", "R00795", 67.49);

        addRowToTable("Peco", "00-9 Box Van Fyffes Bananas", "S00135", 22.90);
        addRowToTable("Peco", "00-9 Box Van Colman's Mustard", "S00513", 22.90);
        addRowToTable("Peco", "00-9 Box Van Bass", "S00531", 22.90);
        addRowToTable("Peco", "SL-600 Flexible Track, Wooden Sleeper", "R00264", 15.00);
        addRowToTable("Peco", "Bullhead OO Gauge Slip-Double", "R00624", 79.96);

        addRowToTable("Dapol", "Sentinel Y1/Y3 LNER 42", "L00642", 195.62);
        addRowToTable("Dapol", "Class 68 68014 Chiltern DCC & Sound", "L00831", 286.20);
        addRowToTable("Dapol", "LHT-626 Suburban B 4 Coach Set BR London #34 Lined Maroon", "M00318", 885.60);
        addRowToTable("Dapol", "LHT 633 No Division & Unnumbered GWR C & C Twin Cities", "M00729", 286.60);
        addRowToTable("Dapol", "2P-003-015 N Gauge B Set Coach Pack BR Crimson 66461 & 6464", "M00927", 37.80);
        // Add more sample data...

        // Make the frame visible
        frame.setVisible(true);
    }

    private void addRowToTable(String brand, String name, String code, double price) {
        Object[] rowData = {brand, name, code, price};
        model.addRow(rowData);

        // Insert into the database
        insertIntoDatabase(brand, name, code, price);
    }

    private void insertIntoDatabase(String brand, String name, String code, double price) {
        // Database connection parameters
        try {
        Class.forName("com.mysql.cj.jdbc.Driver");
        } catch (ClassNotFoundException e) {
        e.printStackTrace();
    }

        String url = "jdbc:mysql://stusql.dcs.shef.ac.uk/team056";
        String username = "team056";
        String password = "ohr4Kahbi";

        try (Connection connection = DriverManager.getConnection(url, username, password)) {
            String query = "INSERT INTO products (brand, name, code, price) VALUES (?, ?, ?, ?)";
            try (PreparedStatement preparedStatement = connection.prepareStatement(query)) {
                preparedStatement.setString(1, brand);
                preparedStatement.setString(2, name);
                preparedStatement.setString(3, code);
                preparedStatement.setDouble(4, price);
                int rowsAffected = preparedStatement.executeUpdate();
                if (rowsAffected > 0) {
                    System.out.println("Insert successful. Rows affected: " + rowsAffected);
            }   else {
                    System.out.println("Insert failed. No rows affected.");
            }   
        }
    } catch (SQLException e) {
        System.err.println("SQLException: " + e.getMessage());
        e.printStackTrace(); // 打印异常堆栈信息
    }
}

    public static void main(String[] args) {
        SwingUtilities.invokeLater(Products::new);
    }
    
    public void setVisible (boolean b ){
        
    }
}





package com.mycompany.loginapp;

import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import java.awt.*;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Map;

public class Cart extends JFrame {

    private DefaultTableModel model;
    private JTable table;
    private JButton deleteButton, confirmOrderButton, returnButton;
    private Map<String, Integer> shoppingCart;

    public Cart(Map<String, Integer> shoppingCart) {
        setTitle("Shopping Cart");
        setSize(800, 400);
        setDefaultCloseOperation(EXIT_ON_CLOSE);

        this.shoppingCart = shoppingCart;

        // 初始化表格模型
        model = new DefaultTableModel();
        model.addColumn("Brand");
        model.addColumn("Product");
        model.addColumn("Quantity");
        model.addColumn("Price");
        model.addColumn("Total Price");

        // 初始化表格
        table = new JTable(model);

        // 创建滚动窗格
        JScrollPane scrollPane = new JScrollPane(table);

        // 初始化按钮
        deleteButton = createStyledButton("Delete from Cart");
        confirmOrderButton = createStyledButton("Confirm Order");
        returnButton = createStyledButton("Return to Shopping");

        // 添加按钮监听器
        deleteButton.addActionListener(e -> deleteFromCart());
        confirmOrderButton.addActionListener(e -> confirmOrder());
        returnButton.addActionListener(e -> returnToShopping());

        // 创建底部面板
        JPanel bottomPanel = new JPanel(new FlowLayout(FlowLayout.CENTER));
        bottomPanel.add(deleteButton);
        bottomPanel.add(confirmOrderButton);
        bottomPanel.add(returnButton);

        // 设置布局
        setLayout(new BorderLayout());
        add(scrollPane, BorderLayout.CENTER);
        add(bottomPanel, BorderLayout.SOUTH);

        // 显示购物车内容
        displayShoppingCart();

        setVisible(true);
    }

    // 创建样式化按钮
    private JButton createStyledButton(String buttonText) {
        JButton button = new JButton(buttonText);
        button.setPreferredSize(new Dimension(150, 40));
        button.setFont(new Font("Arial", Font.PLAIN, 16));
        return button;
    }

    // 显示购物车内容
    private void displayShoppingCart() {
        // 清空表格
        model.setRowCount(0);

        for (Map.Entry<String, Integer> entry : shoppingCart.entrySet()) {
            String productCode = entry.getKey();
            int quantity = entry.getValue();

            try {
                Connection connection = DatabaseConnection.getConnection();
                String query = "SELECT brand, name, price FROM products WHERE code = ?";
                try (PreparedStatement preparedStatement = connection.prepareStatement(query)) {
                    preparedStatement.setString(1, productCode);
                    ResultSet resultSet = preparedStatement.executeQuery();

                    if (resultSet.next()) {
                        String brand = resultSet.getString("brand");
                        String name = resultSet.getString("name");
                        double price = resultSet.getDouble("price");

                        Object[] rowData = {brand, name, quantity, price, quantity * price};
                        model.addRow(rowData);
                    }
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
    }

    // 从购物车中删除产品
    private void deleteFromCart() {
        int selectedRow = table.getSelectedRow();

        if (selectedRow != -1) {
            // 获取选定行的产品信息
            String product = (String) table.getValueAt(selectedRow, 1);

            // 从购物车中移除该产品
            shoppingCart.remove(product);

            // 更新表格显示
            model.removeRow(selectedRow);
        } else {
            JOptionPane.showMessageDialog(this, "Please select a product from the cart.");
        }
    }

    // 确认订单
    private void confirmOrder() {
        int choice = JOptionPane.showConfirmDialog(this, "Are you sure you want to confirm this order?", "Confirm Order", JOptionPane.YES_NO_OPTION);
        if (choice == JOptionPane.YES_OPTION) {
            // TODO: Add code to prompt the user for bank details and complete the order
            showBankDetailsDialog();
        }
    }

    // 弹出对话框以输入银行信息
    private void showBankDetailsDialog() {
        JPanel panel = new JPanel(new GridLayout(6, 2));

        JTextField cardHolderNameField = new JTextField();
        JTextField cardNumberField = new JTextField();
        JTextField cvvField = new JTextField();
        JTextField expiryDateField = new JTextField();

        panel.add(new JLabel("Cardholder Name:"));
        panel.add(cardHolderNameField);
        panel.add(new JLabel("Card Number:"));
        panel.add(cardNumberField);
        panel.add(new JLabel("CVV:"));
        panel.add(cvvField);
        panel.add(new JLabel("Expiry Date:"));
        panel.add(expiryDateField);

        int result = JOptionPane.showConfirmDialog(this, panel, "Enter Bank Details", JOptionPane.OK_CANCEL_OPTION);

        if (result == JOptionPane.OK_OPTION) {
            // TODO: Add code to process the bank details and complete the order
            JOptionPane.showMessageDialog(this, "Order confirmed! Bank details:\n" +
                    "Cardholder Name: " + cardHolderNameField.getText() + "\n" +
                    "Card Number: " + cardNumberField.getText() + "\n" +
                    "CVV: " + cvvField.getText() + "\n" +
                    "Expiry Date: " + expiryDateField.getText());
        }
    }

    // 返回购物界面
    private void returnToShopping() {
        dispose(); // 关闭当前界面
    }

    public static void main(String[] args) {
        // For testing purposes
        SwingUtilities.invokeLater(() -> {
            Map<String, Integer> testCart = Map.of("Product A", 2, "Product B", 1, "Product C", 3);
            new Cart(testCart);
        });
    }
}

