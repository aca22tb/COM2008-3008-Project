import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableColumn;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.Map;

public class Cart extends JFrame {

    private DefaultTableModel model;
    private JTable table;
    private JButton returnButton, confirmOrderButton, clearCartButton;

    public Cart(Map<String, Integer> shoppingCart) {
        setTitle("Shopping Cart");
        setSize(800, 400);
        setDefaultCloseOperation(EXIT_ON_CLOSE);

        // 创建表格和模型
        model = new DefaultTableModel();
        model.addColumn("Brand");
        model.addColumn("Name");
        model.addColumn("Code");
        model.addColumn("Quantity");
        model.addColumn("Price");
        model.addColumn("Total Price");
        model.addColumn("Remove");

        table = new JTable(model);

        // 创建滚动窗格
        JScrollPane scrollPane = new JScrollPane(table);

        // 添加按钮监听器
        returnButton = createStyledButton("Return");
        confirmOrderButton = createStyledButton("Confirm Order");
        clearCartButton = createStyledButton("Clear Cart");

        returnButton.addActionListener(e -> dispose()); // 关闭购物车界面，返回上一层
        confirmOrderButton.addActionListener(e -> showBankInfoDialog());
        clearCartButton.addActionListener(e -> clearCart());

        // 布局设置
        setLayout(new BorderLayout());
        add(scrollPane, BorderLayout.CENTER);

        // 底部添加按钮的组件
        JPanel bottomPanel = new JPanel(new FlowLayout(FlowLayout.CENTER));
        bottomPanel.add(returnButton);
        bottomPanel.add(confirmOrderButton);
        bottomPanel.add(clearCartButton);
        add(bottomPanel, BorderLayout.SOUTH);

        // 显示购物车内容
        displayShoppingCart(shoppingCart);

        setVisible(true);
    }

    // 创建样式化按钮
    private JButton createStyledButton(String buttonText) {
        JButton button = new JButton(buttonText);
        button.setPreferredSize(new Dimension(150, 40));
        button.setFont(new Font("Arial", Font.PLAIN, 16));
        return button;
    }

    // 显示购物车内容
    private void displayShoppingCart(Map<String, Integer> shoppingCart) {
        // 查询数据库或使用其他途径获取产品信息，此处为示例
        for (Map.Entry<String, Integer> entry : shoppingCart.entrySet()) {
            String productCode = entry.getKey();
            int quantity = entry.getValue();
            Object[] rowData = getProductDetails(productCode, quantity);
            model.addRow(rowData);
        }
    }

    // 获取产品详细信息，此处为示例方法，实际项目中应该从数据库或其他途径获取
    private Object[] getProductDetails(String productCode, int quantity) {
        // 假设产品信息如下
        switch (productCode) {
            case "P00312":
                return new Object[]{"Hornby", "L&MR No.58 'Tiger'", "P00312", quantity, 229.99, quantity * 229.99, "Remove"};
            case "M00123":
                return new Object[]{"Hornby", "Red Rover Train Set", "M00123", quantity, 119.99, quantity * 119.99, "Remove"};
            // Add more cases for other product codes...
            default:
                return new Object[]{"", "", "", 0, 0.0, 0.0, ""};
        }
    }

    // 显示银行信息对话框
    private void showBankInfoDialog() {
        // TODO: Add code to show the dialog for entering bank information
        // 提示用户输入银行信息，例如持卡人姓名、卡号、CVV、到期日期等
        // 可以使用 JOptionPane 或自定义的 JDialog
        JOptionPane.showMessageDialog(this, "Enter Bank Information");
    }

    // 清空购物车
    private void clearCart() {
        int option = JOptionPane.showConfirmDialog(
                this,
                "Are you sure you want to clear the cart?",
                "Clear Cart",
                JOptionPane.YES_NO_OPTION,
                JOptionPane.QUESTION_MESSAGE);

        if (option == JOptionPane.YES_OPTION) {
            model.setRowCount(0); // 清空表格
            // TODO: Add code to clear the shopping cart in the database
        }
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> new Cart(new java.util.HashMap<>()));
    }
}
